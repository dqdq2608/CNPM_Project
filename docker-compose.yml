version: "3.9"

services:
  # =============================
  # üóÑ PostgreSQL 
  # =============================
  postgres:
    image: postgres:15
    container_name: postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: 123456
      POSTGRES_DB: foodappdb
      TZ: Asia/Ho_Chi_Minh
    ports:
      - "5432:5432"
    volumes:
      - pg_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  # =============================
  # üë§ User Service (Fastify + Prisma + /metrics)
  # =============================
  user-service:
    build:
      context: ./jojos-burger-BE/services/user
    container_name: user-service
    restart: unless-stopped
    env_file:
      - ./jojos-burger-BE/services/user/.env
    environment:
      DATABASE_URL: postgresql://postgres:123456@postgres:5432/foodappdb?schema=user_service
      SERVICE_NAME: user-service
      TZ: Asia/Ho_Chi_Minh
    depends_on:
      postgres:
        condition: service_healthy
    ports:
      - "3001:3001"

  # =============================
  # (Tu·ª≥ ch·ªçn) Th√™m c√°c service kh√°c sau n√†y
  # =============================
  # order-service:
  #   build:
  #     context: ./services/order   # üëâ ƒê·ªîI theo c·∫•u tr√∫c c·ªßa b·∫°n
  #   env_file:
  #     - ./services/order/.env
  #   environment:
  #     DATABASE_URL: postgresql://app:app123@postgres:5432/appdb?schema=order_service
  #     SERVICE_NAME: order-service
  #   depends_on:
  #     postgres:
  #       condition: service_healthy
  #   ports: ["3003:3003"]

  # product-service:
  #   build:
  #     context: ./services/product
  #   env_file:
  #     - ./services/product/.env
  #   environment:
  #     DATABASE_URL: postgresql://app:app123@postgres:5432/appdb?schema=product_service
  #     SERVICE_NAME: product-service
  #   depends_on:
  #     postgres:
  #       condition: service_healthy
  #   ports: ["3002:3002"]

  # payment-service:
  #   build:
  #     context: ./services/payment
  #   env_file:
  #     - ./services/payment/.env
  #   environment:
  #     DATABASE_URL: postgresql://app:app123@postgres:5432/appdb?schema=payment_service
  #     SERVICE_NAME: payment-service
  #   depends_on:
  #     postgres:
  #       condition: service_healthy
  #   ports: ["3004:3004"]

  # =============================
  # (Tu·ª≥ ch·ªçn) Monitoring ‚Äì b·∫≠t sau khi ·ªïn logic
  # =============================
  # prometheus:
  #   image: prom/prometheus:latest
  #   container_name: prometheus
  #   restart: unless-stopped
  #   command: ["--config.file=/etc/prometheus/prometheus.yml"]
  #   ports: ["9090:9090"]
  #   volumes:
  #     - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro
  #
  # grafana:
  #   image: grafana/grafana:11.1.0
  #   container_name: grafana
  #   restart: unless-stopped
  #   ports: ["3000:3000"]
  #   environment:
  #     GF_SECURITY_ADMIN_USER: admin
  #     GF_SECURITY_ADMIN_PASSWORD: admin123

volumes:
  pg_data:
