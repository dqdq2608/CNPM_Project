# ğŸ§± Base image: PostgreSQL 16 + PostGIS 3.4 + pgvector
FROM postgis/postgis:16-3.4

# ğŸ§© CÃ i thÃªm pgvector extension
RUN apt-get update && \
    apt-get install -y postgresql-16-pgvector && \
    rm -rf /var/lib/apt/lists/*

# âš™ï¸ Environment máº·c Ä‘á»‹nh (cÃ³ thá»ƒ override trong docker-compose hoáº·c .env)
ENV POSTGRES_USER=postgres
ENV POSTGRES_PASSWORD=123456
ENV POSTGRES_DB=catalogdb

# ğŸ—‚ï¸ Volume Ä‘á»ƒ giá»¯ dá»¯ liá»‡u
VOLUME ["/var/lib/postgresql/data"]

# ğŸ§  Healthcheck Ä‘Æ¡n giáº£n (Postgres ready)
HEALTHCHECK --interval=5s --timeout=5s --retries=20 \
    CMD pg_isready -U "$POSTGRES_USER" -d "$POSTGRES_DB" || exit 1

# ğŸšª Máº·c Ä‘á»‹nh Postgres láº¯ng nghe cá»•ng 5432
EXPOSE 5432
